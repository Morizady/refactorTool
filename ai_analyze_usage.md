# AI分析功能使用说明

## 功能概述

新增的`--ai-analyze`参数允许你对Java接口代码进行AI智能分析。该功能会：

1. 执行`--extract-code`的所有逻辑，提取接口调用链的Java代码
2. 显示提取文件的前20行预览
3. 将完整的代码内容发送给AI进行深度分析
4. 生成详细的分析报告并保存

## 使用步骤

### 第一步：生成调用树
首先需要为目标接口生成调用树和方法映射文件：

```bash
python main.py --call-tree <接口路径> --output <输出目录>
```

示例：
```bash
python main.py --call-tree /user/login --output ./migration_output
```

### 第二步：AI分析
然后使用AI分析功能：

```bash
python main.py --ai-analyze <接口路径> --output <输出目录>
```

示例：
```bash
python main.py --ai-analyze /user/login --output ./migration_output
```

## 输出内容

### 1. 控制台输出
- 📝 代码提取进度信息
- 📄 提取文件的前20行预览
- 🤖 AI分析过程状态
- 📊 分析结果摘要

### 2. 生成的文件
- `java_code_<接口名>_jdt.md` - 提取的Java代码
- `ai_analysis_<接口名>.md` - AI分析报告

## AI分析内容

AI会从以下几个方面分析代码：

### 1. 代码结构分析
- 主要的类和方法
- 调用链路分析
- 依赖关系

### 2. 业务逻辑分析
- 核心业务流程
- 数据处理逻辑
- 异常处理机制

### 3. 代码质量评估
- 代码复杂度
- 潜在问题
- 优化建议

### 4. 技术栈识别
- 使用的框架和技术
- 设计模式
- 架构特点

## 前置条件

1. **Ollama服务**：需要本地运行Ollama服务
2. **调用树文件**：必须先生成对应接口的调用树
3. **AI模块**：确保ai_module正确安装和配置

## 示例输出

```
🤖 开始AI分析接口代码: /user/login
📁 项目根目录: /path/to/project
📝 正在提取Java代码...
✅ Java代码已提取到: ./migration_output/java_code__user_login_jdt.md

================================================================================
📄 代码文件前20行预览:
================================================================================
 1: # 接口调用链Java代码提取
 2: 
 3: **接口路径**: /user/login
 4: **提取时间**: 2026-01-11 15:30:45
 5: 
 6: ## 调用链概览
 7: 
 8: ### 主要调用路径
 9: 1. UserController.login()
10: 2. UserService.authenticate()
... (还有 150 行)
================================================================================

🤖 正在初始化AI分析模块...
✅ AI服务初始化成功
🔍 正在进行AI代码分析...
⏳ 这可能需要一些时间，请稍候...

================================================================================
🤖 AI分析结果:
================================================================================
# 代码分析报告

## 1. 代码结构分析
该接口实现了用户登录功能，主要包含以下组件：
- UserController: 控制层，处理HTTP请求
- UserService: 业务逻辑层，实现认证逻辑
- UserMapper: 数据访问层，查询用户信息

## 2. 业务逻辑分析
...
================================================================================

✅ AI分析结果已保存到: ./migration_output/ai_analysis__user_login.md
```

## 注意事项

1. **性能考虑**：AI分析可能需要较长时间，特别是对于复杂的代码
2. **网络要求**：需要稳定的网络连接访问AI服务
3. **文件大小**：过大的代码文件可能影响AI分析效果
4. **依赖检查**：确保所有必要的Python包已安装

## 故障排除

### 常见错误及解决方案

1. **调用树文件不存在**
   ```
   ❌ 调用树文件不存在: ./migration_output/deep_call_tree_xxx_jdt.md
   ```
   解决：先运行`--call-tree`命令生成调用树

2. **AI服务初始化失败**
   ```
   ❌ AI服务初始化失败，请检查Ollama是否正在运行
   ```
   解决：启动Ollama服务

3. **AI模块导入失败**
   ```
   ❌ AI模块导入失败: No module named 'ai_module'
   ```
   解决：检查ai_module是否正确安装

## 完整工作流程示例

```bash
# 1. 分析项目，生成接口列表
python main.py --single /path/to/project --output ./output

# 2. 为特定接口生成调用树
python main.py --call-tree /user/login --output ./output

# 3. 使用AI分析接口代码
python main.py --ai-analyze /user/login --output ./output

# 4. 查看分析结果
cat ./output/ai_analysis__user_login.md
```